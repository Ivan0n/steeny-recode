<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MusicStream ‚Äî Steeny</title>

  <script>
    tailwind = window.tailwind || {};
    tailwind.config = { darkMode: 'class' };
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">
  <link rel="icon" type="image/png" href="https://i.pinimg.com/736x/5a/d6/ef/5ad6ef496c7a7c342b9b0fdf2bce426a.jpg">

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const htmlEl = document.documentElement;
    const themeCircles = document.querySelectorAll('.theme-circle');
    const themes = ['light', 'dark', 'purple', 'green', 'blue', 'red'];

    function setTheme(theme) {
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Ç–µ–º
      themes.forEach(t => htmlEl.classList.remove(t));
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω—É–∂–Ω—ã–π –∫–ª–∞—Å—Å (–∫—Ä–æ–º–µ light, –æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
      if (theme !== 'light') {
        htmlEl.classList.add(theme);
      }
      
      localStorage.setItem('theme', theme);

      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫—Ä—É–∂–æ–∫
      themeCircles.forEach(circle => {
        if (circle.dataset.theme === theme) {
          circle.classList.add('active');
        } else {
          circle.classList.remove('active');
        }
      });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã
    const stored = localStorage.getItem('theme') || 'light';
    setTheme(stored);

    // –ö–ª–∏–∫–∏ –ø–æ –∫—Ä—É–∂–∫–∞–º
    themeCircles.forEach(circle => {
      circle.addEventListener('click', () => setTheme(circle.dataset.theme));
    });
  });
  </script>
</head>

<body class="bg-white text-black dark:bg-gray-900 dark:text-white flex flex-col min-h-screen text-[15px] theme-transition">
  <div class="flex flex-1">
    <aside class="w-60 border-r flex flex-col justify-between theme-transition" id="sidebar">
       <div>
         <div class="flex items-center gap-3 p-5 border-b border-gray-200 dark:border-gray-700 theme-transition">
           <div class="w-10 h-10 rounded flex items-center justify-center font-bold text-lg overflow-hidden">
             <img src="https://i.pinimg.com/736x/5a/d6/ef/5ad6ef496c7a7c342b9b0fdf2bce426a.jpg" alt="" class="w-full h-full object-cover">
           </div>
           <span class="font-bold text-lg">Steeny</span>
         </div>
         <nav id="menu" class="mt-6 flex flex-col gap-3 px-3 text-base">
           <div class="menu-link active" data-section="home"><i class="fa-solid fa-house w-5"></i> –ì–ª–∞–≤–Ω–∞—è</div>
           <div class="menu-link" data-section="search"><i class="fa-solid fa-magnifying-glass w-5"></i> –ü–æ–∏—Å–∫</div>
           <div class="menu-link" data-section="favorites"><i class="fa-solid fa-heart w-5"></i> –õ—é–±–∏–º–æ–µ</div>
           <div class="menu-link" data-section="settings"><i class="fa-solid fa-gear w-5"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
         </nav>
       </div>
    </aside>

    <main class="flex-1 flex flex-col theme-transition" style="padding-left: 240px;">
      <header class="flex justify-end items-center p-5 border-b border-gray-200 dark:border-gray-700 theme-transition">
        <a href="#" id="profileLink" class="flex items-center gap-4 cursor-pointer group">

          <span class="nameuser mr-4">{{ name }}</span>
          <img src="{{ avatar }}" class="w-10 h-10 rounded-full" alt="avatar">
        </a>
        
      </header>

      <div id="content" class="flex-1 overflow-y-auto p-8 theme-transition">
         <div id="section-profile" class="hidden">
    
          <div class="profile-header" style="background-image: url('{{ banner }}');">
            <div class="profile-overlay"></div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏ –∏–º–µ–Ω–∏ -->
            <div class="profile-info">
              <img src="{{ avatar }}" alt="User Avatar" class="profile-avatar fade-in">
              <div class="profile-text fade-up">
                <h1 class="profile-name">{{ name }}</h1>
                <p class="profile-id">ID: {{ user }}</p>
              </div>
            </div>
          </div>

          <div class="profile-content fade-up-delayed">
            <button class="menu-link inline-flex" data-section="settings">
              <i class="fa-solid fa-pencil"></i>
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
            </button>
          </div>
        </div>
        <div id="section-home">
           <h2 class="text-2xl font-bold mb-4">üéµ –í—Å—è –º—É–∑—ã–∫–∞</h2>
           <div class="theme-card" >
             <div class="flex items-center justify-between mb-4">
               <div class="flex items-center gap-2">
                 <input type="text" placeholder="–§–∏–ª—å—Ç—Ä..." class="px-3 py-1 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded text-sm theme-transition" oninput="filterTracks(this.value)">
               </div>
               <a href="https://dalink.to/ivan0n" class="font-bold">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –¥–æ–Ω–∞—Ç–æ–º</a>
             </div>
             <div class="track-list" id="allTracksList" style=" overflow-x: hidden;">
               </div>
           </div>
        </div>

        <div id="section-search" class="hidden">
           <h2 class="text-2xl font-bold mb-4">üîç –ü–æ–∏—Å–∫</h2>
           <div class="flex gap-2 mb-4">
             <input id="searchInput" type="text" placeholder="–ò—Å–∫–∞—Ç—å —Ç—Ä–µ–∫ –∏–ª–∏ –∞—Ä—Ç–∏—Å—Ç–∞..." class="flex-1 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white theme-transition">
             <button onclick="searchMusic()" class="px-4 py-2 bg-black text-white rounded hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200 theme-transition">–ò—Å–∫–∞—Ç—å</button>
           </div>
           <div class="theme-card">
             <div id="searchResults" class="track-list" style="overflow-x: hidden;">
               </div>
           </div>
        </div>

        <div id="section-favorites" class="hidden">
           <h2 class="text-2xl font-bold mb-4">‚ù§Ô∏è –õ—é–±–∏–º—ã–µ —Ç—Ä–µ–∫–∏</h2>
           <div class="theme-card">
             <div class="track-list" id="favoritesList" style="overflow-x: hidden;">
                </div>
           </div>
        </div>

        
                <div id="section-settings" class="hidden">
                  <h2 class="text-2xl font-bold mb-4">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                  <div class="flex gap-3 mb-6">
                    <button class="settings-tab-btn active" data-tab="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
                    <button class="settings-tab-btn" data-tab="themes">–¢–µ–º—ã</button>
                  </div>
                  <div class="theme-card">
                    <div id="settings-profile" class="settings-tab">
                    <div class="theme-card mb-6">
                      <h3 class="font-bold text-lg mb-3">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                      <form action="{{ url_for('update_name') }}" method="POST" class="settings-form">
                        <label for="name">–í–∞—à–µ –∏–º—è</label>
                        <input type="text" id="name" name="name" value="{{ name }}" required class="form-input">
                        <button type="submit" class="form-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º—è</button>
                      </form>
                    </div>
                    <div class="theme-card mb-6">
                      <h3 class="font-bold text-lg mb-3">–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</h3>
                      <form action="{{ url_for('update_avatar') }}" method="POST" enctype="multipart/form-data" class="settings-form">
                        <label for="avatar">–ù–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä (jpg, png, gif)</label>
                        <input type="file" id="avatar" name="avatar" accept="image/*" required class="form-input file">
                        <button type="submit" class="form-button">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
                      </form>
                    </div>
                    <div class="theme-card mb-6">
                      <h3 class="font-bold text-lg mb-3">–°–º–µ–Ω–∏—Ç—å –±–∞–Ω–Ω–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è</h3>
                      <form action="{{ url_for('update_banner') }}" method="POST" enctype="multipart/form-data" class="settings-form">
                        <label for="banner">–ù–æ–≤—ã–π –±–∞–Ω–Ω–µ—Ä (jpg, png, gif)</label>
                        <input type="file" id="banner" name="banner" accept="image/*" required class="form-input file">
                        <button type="submit" class="form-button">–ó–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</button>
                      </form>
                    </div>
                    <div class="theme-card mb-6">
                      <h3 class="font-bold text-lg mb-3">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h3>
                      <form action="{{ url_for('update_password') }}" method="POST" class="settings-form">
                        <label for="old_password">–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="old_password" name="old_password" required class="form-input">
                        <label for="new_password" class="mt-2">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="new_password" name="new_password" required class="form-input">
                        <button type="submit" class="form-button">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                      </form>
                    </div>
                  </div>

                  </div>

                  

                  

                  <!-- === –í–∫–ª–∞–¥–∫–∞: –¢–ï–ú–´ === -->
                  <div id="settings-themes" class="settings-tab hidden">
                    <div class="theme-card mb-6">
                      <h3 class="font-bold text-lg mb-3">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h3>
                      <div class="flex items-center gap-4 mt-2">
                        <div class="theme-circle" data-theme="light" title="–°–≤–µ—Ç–ª–∞—è" style="background-color: #f3f4f6; border: 1px solid #d1d5db;"></div>
                        <div class="theme-circle" data-theme="dark" title="–¢—ë–º–Ω–∞—è" style="background-color: #1f2937;"></div>
                        <div class="theme-circle" data-theme="purple" title="–§–∏–æ–ª–µ—Ç–æ–≤–∞—è" style="background-color: #7e22ce;"></div>
                        <div class="theme-circle" data-theme="green" title="–ó–µ–ª—ë–Ω–∞—è" style="background-color: #10b981;"></div>
                        <div class="theme-circle" data-theme="blue" title="–°–∏–Ω—è—è" style="background-color: #3b82f6;"></div>
                        <div class="theme-circle" data-theme="red" title="–ö—Ä–∞—Å–Ω–∞—è" style="background-color: #ef4444;"></div> 
                      </div>
                    </div>
                  </div>

                  <div class="theme-card">
                    <a href="/logout" class="link text-red-500 hover:underline">
                      <i class="fa-solid fa-right-from-bracket w-5"></i> –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                    </a>
                  </div>
              </div>
            </div>
          </main>
        </div>
      </div>
    </main>
  </div>

  <footer class="player border-t p-4 fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-gray-800 theme-transition">
    <div class="fullscreen-visuals">
        <button id="fullscreenCloseBtn" class="fullscreen-close-btn"><i class="fa-solid fa-compress"></i></button>
        <img id="fullscreenCoverImg" src="https://via.placeholder.com/300" class="fullscreen-cover" alt="cover">
        <div class="fullscreen-info">
            <div id="fullscreenTrackTitle" class="font-bold text-2xl">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</div>
            <div id="fullscreenTrackArtist" class="text-lg opacity-80">–ê—Ä—Ç–∏—Å—Ç</div>
        </div>
    </div>
    
    <div class="player-content">
      <div class="mb-2">
        <input type="range" id="seekbar" class="seekbar" value="0" max="100">
        <div class="flex justify-between w-full text-xs text-gray-500 dark:text-gray-400 theme-transition">
          <span id="currentTime">0:00</span>
          <span id="duration">0:00</span>
        </div>
      </div>

      <div class="flex items-center justify-between">
        <div class="left-meta">
          <img id="coverImg" src="https://via.placeholder.com/64" class="w-14 h-14 rounded" alt="cover">
          <div>
            <div id="trackTitle" class="font-semibold text-sm">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</div>
            <div id="trackArtist" class="text-xs text-gray-500 dark:text-gray-400 theme-transition">–ê—Ä—Ç–∏—Å—Ç</div>
          </div>
          <button id="favBtn" class="ml-3 text-2xl text-gray-400 hover:text-yellow-500"><i class="fa-solid fa-star"></i></button>
        </div>

        <div class="controls-center">
          <button id="prevBtn" class="player-btn"><i class="fa-solid fa-backward-step"></i></button>
          <button id="playBtn" class="player-btn play"><i id="playIcon" class="fa-solid fa-play"></i></button>
          <button id="nextBtn" class="player-btn"><i class="fa-solid fa-forward-step"></i></button>
          <button id="repeatBtn" class="player-btn"><i id="repeatIcon" class="fa-solid fa-repeat"></i></button>
        </div>

        <div class="right-volume">
          <i id="volumeIcon" class="fa-solid fa-volume-high"></i>
          <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.01" value="1">
          <button id="fullscreenBtn" class="player-btn small-btn ml-2"><i class="fa-solid fa-expand"></i></button>
        </div>
      </div>
    </div>
    
    <audio id="audioPlayer"></audio>
  </footer>

  <script type="module" src="{{ url_for('static', filename='music_player_js/homepage.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='music_player_js/media-session.js') }}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const menuLinks = document.querySelectorAll('.menu-link');
        const contentSections = document.querySelectorAll('#content > div[id^="section-"]');
        const profileLink = document.getElementById('profileLink');

        function showSection(sectionId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            contentSections.forEach(section => {
                section.classList.add('hidden');
            });
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é
            const activeSection = document.getElementById(`section-${sectionId}`);
            if (activeSection) {
                activeSection.classList.remove('hidden');
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Å—Å—ã–ª–∫—É –≤ –º–µ–Ω—é
            menuLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.section === sectionId);
            });
        }

        // –ö–ª–∏–∫–∏ –ø–æ –º–µ–Ω—é
        menuLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = link.dataset.section;
                showSection(sectionId);
            });
        });

        // –ö–ª–∏–∫ –ø–æ –ø—Ä–æ—Ñ–∏–ª—é –≤ —à–∞–ø–∫–µ
        if (profileLink) {
            profileLink.addEventListener('click', (e) => {
                e.preventDefault();
                showSection('profile');
            });
        }
        
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 'home'
        showSection('home');
    });
  </script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
    const tabButtons = document.querySelectorAll('.settings-tab-btn');
    const tabs = document.querySelectorAll('.settings-tab');

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.dataset.tab;

        // –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
        tabButtons.forEach(b => b.classList.toggle('active', b === btn));

        // –ü–æ–∫–∞–∑ –Ω—É–∂–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
        tabs.forEach(tab => {
          tab.classList.toggle('hidden', tab.id !== 'settings-' + tabId);
        });
      });
    });
  });
  </script>

</body>
</html>